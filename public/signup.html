<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sign Up</title>
  <style>
    body { font-family: Arial; background-color: #f0f0f0; display: flex; justify-content: center; align-items: center; height: 100vh; }
    .signup-box { background: white; padding: 25px; width: 360px; border-radius: 10px; box-shadow: 0 0 12px rgba(0,0,0,0.2); }
    h2 { text-align: center; margin-bottom: 15px; }
    input, select { width: 100%; padding: 12px; margin: 8px 0; border-radius: 5px; border: 1px solid #999; font-size: 16px; }
    button { width: 100%; padding: 12px; background: #2196f3; color: white; font-size: 18px; border: none; border-radius: 5px; margin-top: 10px; cursor: pointer; }
    button:hover { background: #1e88e5; }
    #result { margin-top: 12px; text-align: center; font-weight: bold; }
    .link { text-align: center; margin-top: 12px; }
  </style>
</head>
<body>

<div class="signup-box">
  <h2>Sign Up</h2>

  <input type="text" id="first_name" placeholder="First Name" />
  <input type="text" id="last_name" placeholder="Last Name" />
  <input type="email" id="email" placeholder="Email" />
  <input type="password" id="password" placeholder="Password" />

  <select id="role" onchange="showRoleFields()">
    <option value="">Select Role</option>
    <option value="doctor">Doctor</option>
    <option value="therapist">Therapist</option>
    <option value="patient">Patient</option>
    <option value="donor">Donor</option>
  </select>

  <div id="role-fields"></div>

  <button onclick="signup()">Create Account</button>
  <p id="result"></p>

  <!-- رابط مباشر إلى صفحة Login -->
  <p class="link">
    Already have an account? <a href="login.html">Login here</a>
  </p>
</div>

<script>
function showRoleFields() {
  const role = document.getElementById("role").value;
  const container = document.getElementById("role-fields");
  container.innerHTML = "";

  if(role === "patient"){
    container.innerHTML = `
      <input type="number" id="age" placeholder="Age">
      <select id="gender">
        <option value="">Select Gender</option>
        <option value="male">Male</option>
        <option value="female">Female</option>
      </select>
    `;
  } else if(role === "donor"){
    container.innerHTML = `
      <select id="blood_type">
        <option value="">Select Blood Type</option>
        <option value="A+">A+</option>
        <option value="A-">A-</option>
        <option value="B+">B+</option>
        <option value="B-">B-</option>
        <option value="AB+">AB+</option>
        <option value="AB-">AB-</option>
        <option value="O+">O+</option>
        <option value="O-">O-</option>
      </select>
    `;
  } else if(role === "doctor" || role === "therapist"){
    container.innerHTML = `
      <input type="text" id="specialty" placeholder="Specialty">
      <input type="text" id="phone" placeholder="Phone">
    `;
    if(role === "doctor"){
      container.innerHTML += `<input type="text" id="clinic" placeholder="Clinic Address (optional)">`;
    }
  }
}

async function signup(){
  const first_name = document.getElementById("first_name").value;
  const last_name = document.getElementById("last_name").value;
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  const role = document.getElementById("role").value;
  const result = document.getElementById("result");

  if(!first_name || !last_name || !email || !password || !role){
    result.style.color = "red";
    result.textContent = "Please fill all required fields.";
    return;
  }

  const extraData = {};
  if(role === "patient"){
    extraData.age = document.getElementById("age").value;
    extraData.gender = document.getElementById("gender").value;
  } else if(role === "donor"){
    extraData.blood_type = document.getElementById("blood_type").value;
  } else if(role === "doctor" || role === "therapist"){
    extraData.specialty = document.getElementById("specialty").value;
    const phoneField = document.getElementById("phone");
    if(phoneField) extraData.phone = phoneField.value;
    const clinicField = document.getElementById("clinic");
    if(clinicField) extraData.clinic = clinicField.value;
  }

  try {
    const response = await fetch("/api/signup", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({first_name,last_name,email,password,role,extraData})
    });
    const data = await response.json();

    if(response.ok && data.message.includes("success")){
      result.style.color = "green";
      result.textContent = "Account created successfully! Redirecting to login...";
      setTimeout(()=>window.location.href="login.html",1500);
    } else {
      result.style.color = "red";
      result.textContent = data.message;
    }
  } catch(err){
    console.error("Frontend error:", err);
    result.style.color = "red";
    result.textContent = "Server error";
  }
}
</script>
</body>
</html>
